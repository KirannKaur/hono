<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="697.2px" preserveAspectRatio="none" style="width:1238px;height:697px;" version="1.1" viewBox="0 0 1238 697" width="1238.4px" zoomAndPan="magnify"><defs><filter height="300%" id="f1v6hoffgk6ltq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.4"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.8" dy="4.8" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="679.4156" style="stroke: #A80036; stroke-width: 1.2;" width="461.4" x="672" y="4.8"/><text fill="#000000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="138" x="833.7" y="19.2803">Device Registry</text><rect fill="#FFFFFF" filter="url(#f1v6hoffgk6ltq)" height="480.8719" style="stroke: #A80036; stroke-width: 1.2;" width="12" x="273" y="127.0313"/><rect fill="#FFFFFF" filter="url(#f1v6hoffgk6ltq)" height="34.9594" style="stroke: #A80036; stroke-width: 1.2;" width="12" x="711" y="213.75"/><rect fill="#FFFFFF" filter="url(#f1v6hoffgk6ltq)" height="34.9594" style="stroke: #A80036; stroke-width: 1.2;" width="12" x="854.4" y="562.1438"/><rect fill="#FFFFFF" filter="url(#f1v6hoffgk6ltq)" height="139.9969" style="stroke: #A80036; stroke-width: 1.2;" width="12" x="1065" y="335.4281"/><line style="stroke: #A80036; stroke-width: 1.2; stroke-dasharray: 5.0,5.0;" x1="48" x2="48" y1="89.6719" y2="618.7031"/><line style="stroke: #A80036; stroke-width: 1.2; stroke-dasharray: 5.0,5.0;" x1="279" x2="279" y1="89.6719" y2="618.7031"/><line style="stroke: #A80036; stroke-width: 1.2; stroke-dasharray: 5.0,5.0;" x1="716.4" x2="716.4" y1="89.6719" y2="618.7031"/><line style="stroke: #A80036; stroke-width: 1.2; stroke-dasharray: 5.0,5.0;" x1="860.4" x2="860.4" y1="89.6719" y2="618.7031"/><line style="stroke: #A80036; stroke-width: 1.2; stroke-dasharray: 5.0,5.0;" x1="1071" x2="1071" y1="89.6719" y2="618.7031"/><rect fill="#FEFECE" filter="url(#f1v6hoffgk6ltq)" height="36.3562" style="stroke: #A80036; stroke-width: 1.7999999999999998;" width="73.2" x="9.6" y="47.3156"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="56.4" x="18" y="71.3098">Device</text><rect fill="#FEFECE" filter="url(#f1v6hoffgk6ltq)" height="36.3562" style="stroke: #A80036; stroke-width: 1.7999999999999998;" width="73.2" x="9.6" y="617.5031"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="56.4" x="18" y="641.4973">Device</text><rect fill="#FEFECE" filter="url(#f1v6hoffgk6ltq)" height="36.3562" style="stroke: #A80036; stroke-width: 1.7999999999999998;" width="204" x="174.6" y="47.3156"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="187.2" x="183" y="71.3098">Hono Protocol Adapter</text><rect fill="#FEFECE" filter="url(#f1v6hoffgk6ltq)" height="36.3562" style="stroke: #A80036; stroke-width: 1.7999999999999998;" width="204" x="174.6" y="617.5031"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="187.2" x="183" y="641.4973">Hono Protocol Adapter</text><rect fill="#FEFECE" filter="url(#f1v6hoffgk6ltq)" height="55.9125" style="stroke: #A80036; stroke-width: 1.7999999999999998;" width="75.6" x="676.8" y="27.7594"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="58.8" x="685.2" y="51.7535">Tenant</text><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="702" y="71.3098">API</text><rect fill="#FEFECE" filter="url(#f1v6hoffgk6ltq)" height="55.9125" style="stroke: #A80036; stroke-width: 1.7999999999999998;" width="75.6" x="676.8" y="617.5031"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="58.8" x="685.2" y="641.4973">Tenant</text><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="702" y="661.0535">API</text><rect fill="#FEFECE" filter="url(#f1v6hoffgk6ltq)" height="55.9125" style="stroke: #A80036; stroke-width: 1.7999999999999998;" width="177.6" x="769.2" y="27.7594"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="160.8" x="777.6" y="51.7535">Device Registration</text><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="845.4" y="71.3098">API</text><rect fill="#FEFECE" filter="url(#f1v6hoffgk6ltq)" height="55.9125" style="stroke: #A80036; stroke-width: 1.7999999999999998;" width="177.6" x="769.2" y="617.5031"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="160.8" x="777.6" y="641.4973">Device Registration</text><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="845.4" y="661.0535">API</text><rect fill="#FEFECE" filter="url(#f1v6hoffgk6ltq)" height="55.9125" style="stroke: #A80036; stroke-width: 1.7999999999999998;" width="110.4" x="1013.4" y="27.7594"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="93.6" x="1021.8" y="51.7535">Credentials</text><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="1056" y="71.3098">API</text><rect fill="#FEFECE" filter="url(#f1v6hoffgk6ltq)" height="55.9125" style="stroke: #A80036; stroke-width: 1.7999999999999998;" width="110.4" x="1013.4" y="617.5031"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="93.6" x="1021.8" y="641.4973">Credentials</text><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="1056" y="661.0535">API</text><rect fill="#FFFFFF" filter="url(#f1v6hoffgk6ltq)" height="480.8719" style="stroke: #A80036; stroke-width: 1.2;" width="12" x="273" y="127.0313"/><rect fill="#FFFFFF" filter="url(#f1v6hoffgk6ltq)" height="34.9594" style="stroke: #A80036; stroke-width: 1.2;" width="12" x="711" y="213.75"/><rect fill="#FFFFFF" filter="url(#f1v6hoffgk6ltq)" height="34.9594" style="stroke: #A80036; stroke-width: 1.2;" width="12" x="854.4" y="562.1438"/><rect fill="#FFFFFF" filter="url(#f1v6hoffgk6ltq)" height="139.9969" style="stroke: #A80036; stroke-width: 1.2;" width="12" x="1065" y="335.4281"/><polygon fill="#A80036" points="258.6,122.2312,270.6,127.0313,258.6,131.8312,263.4,127.0313" style="stroke: #A80036; stroke-width: 1.2;"/><line style="stroke: #A80036; stroke-width: 1.2;" x1="48.6" x2="265.8" y1="127.0313" y2="127.0313"/><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="201.6" x="57" y="120.9521">connect(X.509 Client Cert)</text><rect fill="#EEEEEE" filter="url(#f1v6hoffgk6ltq)" height="3.6" style="stroke: #EEEEEE; stroke-width: 1.2;" width="1221" x="3.6" y="161.3109"/><line style="stroke: #000000; stroke-width: 1.2;" x1="3.6" x2="1224.6" y1="161.3109" y2="161.3109"/><line style="stroke: #000000; stroke-width: 1.2;" x1="3.6" x2="1224.6" y1="164.9109" y2="164.9109"/><rect fill="#EEEEEE" filter="url(#f1v6hoffgk6ltq)" height="27.7594" style="stroke: #000000; stroke-width: 2.4;" width="138" x="545.1" y="148.6313"/><text fill="#000000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115.2" x="552.3" y="167.9115">Query tenant</text><polygon fill="#A80036" points="696.6,208.95,708.6,213.75,696.6,218.55,701.4,213.75" style="stroke: #A80036; stroke-width: 1.2;"/><line style="stroke: #A80036; stroke-width: 1.2;" x1="285" x2="703.8" y1="213.75" y2="213.75"/><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="403.2" x="293.4" y="207.6709">transfer(subject: "get", body: {"subject-dn": $caDN})</text><polygon fill="#A80036" points="298.2,243.9094,286.2,248.7094,298.2,253.5094,293.4,248.7094" style="stroke: #A80036; stroke-width: 1.2;"/><line style="stroke: #A80036; stroke-width: 1.2;" x1="291" x2="715.8" y1="248.7094" y2="248.7094"/><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="333.6" x="305.4" y="242.6303">transfer(status: "200", ..., body: tenant info)</text><rect fill="#EEEEEE" filter="url(#f1v6hoffgk6ltq)" height="3.6" style="stroke: #EEEEEE; stroke-width: 1.2;" width="1221" x="3.6" y="282.9891"/><line style="stroke: #000000; stroke-width: 1.2;" x1="3.6" x2="1224.6" y1="282.9891" y2="282.9891"/><line style="stroke: #000000; stroke-width: 1.2;" x1="3.6" x2="1224.6" y1="286.5891" y2="286.5891"/><rect fill="#EEEEEE" filter="url(#f1v6hoffgk6ltq)" height="27.7594" style="stroke: #000000; stroke-width: 2.4;" width="181.2" x="523.5" y="270.3094"/><text fill="#000000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158.4" x="530.7" y="289.5896">Query Credentials</text><polygon fill="#A80036" points="1050.6,330.6281,1062.6,335.4281,1050.6,340.2281,1055.4,335.4281" style="stroke: #A80036; stroke-width: 1.2;"/><line style="stroke: #A80036; stroke-width: 1.2;" x1="285" x2="1057.8" y1="335.4281" y2="335.4281"/><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="757.2" x="293.4" y="329.349">transfer(subject: "get", body: {"type": "x509-cert", "auth-id": $subjectDN, "client-certificate": $cert})</text><line style="stroke: #A80036; stroke-width: 1.2;" x1="1077" x2="1127.4" y1="424.8656" y2="424.8656"/><line style="stroke: #A80036; stroke-width: 1.2;" x1="1127.4" x2="1127.4" y1="424.8656" y2="440.4656"/><line style="stroke: #A80036; stroke-width: 1.2;" x1="1078.2" x2="1127.4" y1="440.4656" y2="440.4656"/><polygon fill="#A80036" points="1090.2,435.6656,1078.2,440.4656,1090.2,445.2656,1085.4,440.4656" style="stroke: #A80036; stroke-width: 1.2;"/><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="51.6" x="1085.4" y="364.3084">Create</text><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="120" x="1085.4" y="382.4678">Credentials and</text><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="91.2" x="1085.4" y="400.6271">Registration</text><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="87.6" x="1085.4" y="418.7865">Information</text><polygon fill="#A80036" points="298.2,470.625,286.2,475.425,298.2,480.225,293.4,475.425" style="stroke: #A80036; stroke-width: 1.2;"/><line style="stroke: #A80036; stroke-width: 1.2;" x1="291" x2="1069.8" y1="475.425" y2="475.425"/><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="343.2" x="305.4" y="469.3459">transfer(status: "200", body: credentials info)</text><rect fill="#EEEEEE" filter="url(#f1v6hoffgk6ltq)" height="3.6" style="stroke: #EEEEEE; stroke-width: 1.2;" width="1221" x="3.6" y="509.7047"/><line style="stroke: #000000; stroke-width: 1.2;" x1="3.6" x2="1224.6" y1="509.7047" y2="509.7047"/><line style="stroke: #000000; stroke-width: 1.2;" x1="3.6" x2="1224.6" y1="513.3047" y2="513.3047"/><rect fill="#EEEEEE" filter="url(#f1v6hoffgk6ltq)" height="27.7594" style="stroke: #000000; stroke-width: 2.4;" width="296.4" x="465.9" y="497.025"/><text fill="#000000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="273.6" x="473.1" y="516.3053">Query Registration Information</text><polygon fill="#A80036" points="840,557.3438,852,562.1438,840,566.9438,844.8,562.1438" style="stroke: #A80036; stroke-width: 1.2;"/><line style="stroke: #A80036; stroke-width: 1.2;" x1="285" x2="847.2" y1="562.1438" y2="562.1438"/><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="274.8" x="293.4" y="556.0646">transfer(subject: "assert", device-id)</text><polygon fill="#A80036" points="298.2,592.3031,286.2,597.1031,298.2,601.9031,293.4,597.1031" style="stroke: #A80036; stroke-width: 1.2;"/><line style="stroke: #A80036; stroke-width: 1.2;" x1="291" x2="859.2" y1="597.1031" y2="597.1031"/><text fill="#000000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="391.2" x="305.4" y="591.024">transfer(status: "200", ..., body: registration status)</text><!--MD5=[c421d2c7e9811e27fdb68343cdfb6aff]
@startuml
skinparam BoxPadding 10
scale 1.2

participant "Device"
participant "Hono Protocol Adapter" as PA
box "Device Registry" 
  participant "Tenant\nAPI" as tenant 
  participant "Device Registration\nAPI" as reg 
  participant "Credentials\nAPI" as cred 
end box

Device -> PA++: connect(X.509 Client Cert)


== Query tenant ==
PA -> tenant++: transfer(subject: "get", body: {"subject-dn": $caDN})
PA <- tenant- -: transfer(status: "200", ..., body: tenant info)

== Query Credentials ==
PA -> cred++: transfer(subject: "get", body: {"type": "x509-cert", "auth-id": $subjectDN, "client-certificate": $cert}) 
cred -> cred: Create\nCredentials and \nRegistration\nInformation
PA <- cred- -: transfer(status: "200", body: credentials info)

== Query Registration Information ==
PA -> reg++: transfer(subject: "assert", device-id)
PA <- reg- -: transfer(status: "200", ..., body: registration status)
@enduml

PlantUML version 1.2019.12(Sun Nov 03 10:24:54 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>